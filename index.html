<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request for Proposal (Commercial PV)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #000000;
            color: #fff;
            padding: 20px;
        }
        h1 {
            color: #ffffff;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"], input[type="email"], select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #212120;
            border-radius: 4px;
        }
        .required {
            color: red;
        }
        .optional {
            color: gray;
        }
        .btn-submit, .btn-new, .btn-dashboard {
            background-color: #212120;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .hidden {
            display: none;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.0.0/crypto-js.min.js"></script>
</head>
<body>

<h1>Request for Proposal (Commercial PV)</h1>

<form id="rfp-form">
    <div class="form-group">
        <label for="rep-name">Rep Name <span class="required">*</span></label>
        <input type="text" id="rep-name" name="repName" required>
    </div>
    <div class="form-group">
        <label for="rep-email">Rep Email <span class="required">*</span></label>
        <input type="email" id="rep-email" name="repEmail" required>
    </div>
    <div class="form-group">
        <label for="customer-name">Customer Name (POC)</label>
        <input type="text" id="customer-name" name="customerName">
    </div>
    <div class="form-group">
        <label for="company-name">Company Name <span class="required">*</span></label>
        <input type="text" id="company-name" name="companyName" required>
    </div>
    <div class="form-group">
        <label for="company-email">Email <span class="required">*</span> <span class="optional">(Phone or Email required for tracking)</span></label>
        <input type="email" id="company-email" name="companyEmail">
    </div>
    <div class="form-group">
        <label for="company-address">Company Address <span class="required">*</span></label>
        <input type="text" id="company-address" name="companyAddress" required>
    </div>
    <div class="form-group">
        <label for="state">State <span class="required">*</span></label>
        <select id="state" name="state" required>
        </select>
    </div>
    <div class="form-group">
        <label for="city">Nearest City <span class="required">*</span></label>
        <select id="city" name="city" required>
        </select>
    </div>
    <div class="form-group">
        <label for="install-location">Install Location (Coordinates) <span class="optional">(Desired location of Panels)</span></label>
        <input type="text" id="install-location" name="installLocation">
    </div>
    <div class="form-group">
        <label for="usage-type">Usage Type</label>
        <select id="usage-type" name="usageType">
            <option value="monthly">Monthly</option>
            <option value="daily">Daily</option>
        </select>
    </div>
    <div class="form-group">
        <label for="january">January</label>
        <input type="number" id="january" name="january">
    </div>
    <div class="form-group">
        <label for="february">February</label>
        <input type="number" id="february" name="february">
    </div>
    <div class="form-group">
        <label for="march">March</label>
        <input type="number" id="march" name="march">
    </div>
    <div class="form-group">
        <label for="april">April</label>
        <input type="number" id="april" name="april">
    </div>
    <div class="form-group">
        <label for="may">May</label>
        <input type="number" id="may" name="may">
    </div>
    <div class="form-group">
        <label for="june">June</label>
        <input type="number" id="june" name="june">
    </div>
    <div class="form-group">
        <label for="july">July</label>
        <input type="number" id="july" name="july">
    </div>
    <div class="form-group">
        <label for="august">August</label>
        <input type="number" id="august" name="august">
    </div>
    <div class="form-group">
        <label for="september">September</label>
        <input type="number" id="september" name="september">
    </div>
    <div class="form-group">
        <label for="october">October</label>
        <input type="number" id="october" name="october">
    </div>
    <div class="form-group">
        <label for="november">November</label>
        <input type="number" id="november" name="november">
    </div>
    <div class="form-group">
        <label for="december">December</label>
        <input type="number" id="december" name="december">
    </div>
    <div class="form-group">
        <label for="rfp-delivery-date">RFP Delivery Date</label>
        <input type="datetime-local" 
               id="rfp-delivery-date" 
               name="rfpDeliveryDate" 
               min="2024-01-01T00:00" 
               max="2050-12-31T23:59" 
               step="1">
    </div>

    <!-- Hidden fields for IDs -->
    <input type="hidden" id="rep-id" name="repId">
    <input type="hidden" id="company-id" name="companyId">
    <input type="text" id="rfp-id" name="rfpId">

    <button type="submit" class="btn-submit">Submit</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Define the URL of your CSV file
        const csvUrl = 'https://lckdin-files.s3.us-east-2.amazonaws.com/App/City_State+-+Sheet1+(3).csv';

        // Create a map to hold city data by state
        const stateCityMap = {};

        // Load and parse the CSV file
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            complete: function(results) {
                results.data.forEach(row => {
                    const state = row.State;
                    const city = row.City;

                    if (!stateCityMap[state]) {
                        stateCityMap[state] = [];
                    }
                    stateCityMap[state].push(city);
                });

                // Populate the state dropdown
                populateStateDropdown();
            }
        });

        // Function to populate the state dropdown
        function populateStateDropdown() {
            const stateSelect = document.getElementById('state');
            stateSelect.innerHTML = ''; // Clear previous options

            const states = [
                "California", "Idaho", "Colorado", "Alabama", "Alaska", "Arizona", "Arkansas",
                "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii",
                "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana",
                "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota",
                "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada",
                "New Hampshire", "New Jersey", "New Mexico", "New York",
                "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon",
                "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota",
                "Tennessee", "Texas", "Utah", "Vermont", "Virginia", "Washington",
                "West Virginia", "Wisconsin", "Wyoming"
            ];

            states.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.textContent = state;
                stateSelect.appendChild(option);
            });

            // Listen for changes on the state dropdown to populate the city dropdown
            stateSelect.addEventListener('change', function() {
                populateCityDropdown(this.value);
            });
        }

        // Function to populate the city dropdown based on the selected state
        function populateCityDropdown(state) {
            const citySelect = document.getElementById('city');
            citySelect.innerHTML = ''; // Clear previous options

            if (stateCityMap[state]) {
                stateCityMap[state].forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.textContent = city;
                    citySelect.appendChild(option);
                });
            }
        }

        // Function to generate a hash from input strings
        function generateHash(input) {
            return CryptoJS.MD5(input).toString(CryptoJS.enc.Hex).substring(0, 5);
        }

        // Listen for form submission
        const form = document.getElementById('rfp-form');
        form.addEventListener('submit', async function(event) {
            // Prevent the default form submission
            event.preventDefault();

            // Get the rep name and email
            const repName = document.getElementById('rep-name').value;
            const repEmail = document.getElementById('rep-email').value;

            // Get the company name and email
            const companyName = document.getElementById('company-name').value;
            const companyEmail = document.getElementById('company-email').value;

            // Generate and set the IDs
            document.getElementById('rep-id').value = generateHash(repName + repEmail);
            document.getElementById('company-id').value = 'C' + generateHash(companyName + companyEmail);
            document.getElementById('rfp-id').value = 'R' + generateHash(Date.now().toString());

            // Prepare form data
            const formData = new FormData(form);

            // Send data to the server via POST request
            try {
                const response = await fetch('https://script.google.com/macros/s/AKfycby3lwBKM39PMD7E342weO6U7VgZcIhUldKlcekgB-Fn5B7BEG5S43uOGu1zQOwZf4Q/exec', {
                    method: 'POST',
                    body: formData
                });

                const result = await response.text();

        if (result === 'Success') {
            alert('RFP submitted successfully!');
            window.location.href = 'confirmation.html?message=RFP Received';
        } else {
            alert('Failed to submit RFP. Please try again.');
        }
    } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while submitting the RFP.');
    }
});
</script>

</body>
</html>
