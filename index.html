<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Request for Proposal (Commercial PV)</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f8ff;
            color: #000;
            padding: 20px;
        }
        h1 {
            color: #1e90ff;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
        }
        input[type="text"], input[type="email"], select {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .required {
            color: red;
        }
        .optional {
            color: gray;
        }
        .btn-submit {
            background-color: #1e90ff;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
</head>
<body>

<h1>Request for Proposal (Commercial PV)</h1>

<form id="rfp-form">
    <!-- Form Fields -->
    <div class="form-group">
        <label for="rep-name">Rep Name <span class="required">*</span></label>
        <input type="text" id="rep-name" name="repName" required>
    </div>
    <!-- Additional Form Fields -->
    <!-- State Dropdown -->
    <div class="form-group">
        <label for="state">State <span class="required">*</span></label>
        <select id="state" name="state" required>
            <!-- Options populated dynamically -->
        </select>
    </div>
    <!-- City Dropdown -->
    <div class="form-group">
        <label for="city">Nearest City <span class="required">*</span></label>
        <select id="city" name="city" required>
            <!-- Options populated dynamically based on state selection -->
        </select>
    </div>
    <!-- Additional Form Fields -->
    <button type="submit" class="btn-submit">Submit</button>
</form>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Define the URL of your CSV file
        const csvUrl = 'https://lckdin-files.s3.us-east-2.amazonaws.com/App/City_State+-+Sheet1+(3).csv';

        // Create a map to hold city data by state
        const stateCityMap = {};

        // Load and parse the CSV file
        Papa.parse(csvUrl, {
            download: true,
            header: true,
            complete: function(results) {
                results.data.forEach(row => {
                    const state = row.State;
                    const city = row.City;

                    if (!stateCityMap[state]) {
                        stateCityMap[state] = [];
                    }
                    stateCityMap[state].push(city);
                });

                // Populate the state dropdown
                populateStateDropdown();
            }
        });

        // Function to populate the state dropdown
        function populateStateDropdown() {
            const states = [
                "Alabama", "Alaska", "Arizona", "Arkansas", "California", "Colorado",
                "Connecticut", "Delaware", "Florida", "Georgia", "Hawaii", "Idaho",
                "Illinois", "Indiana", "Iowa", "Kansas", "Kentucky", "Louisiana",
                "Maine", "Maryland", "Massachusetts", "Michigan", "Minnesota",
                "Mississippi", "Missouri", "Montana", "Nebraska", "Nevada",
                "New Hampshire", "New Jersey", "New Mexico", "New York",
                "North Carolina", "North Dakota", "Ohio", "Oklahoma", "Oregon",
                "Pennsylvania", "Rhode Island", "South Carolina", "South Dakota",
                "Tennessee", "Texas", "Utah", "Vermont", "Virginia",
                "Washington", "West Virginia", "Wisconsin", "Wyoming"
            ];

            const stateDropdown = document.getElementById('state');
            states.forEach(state => {
                const option = document.createElement('option');
                option.value = state;
                option.text = state;
                stateDropdown.add(option);
            });

            // Add event listener to update cities based on selected state
            stateDropdown.addEventListener('change', function() {
                const selectedState = this.value;
                populateCityDropdown(selectedState);
            });
        }

        // Function to populate the city dropdown based on the selected state
        function populateCityDropdown(state) {
            const cityDropdown = document.getElementById('city');
            cityDropdown.innerHTML = ''; // Clear existing options

            if (stateCityMap[state]) {
                stateCityMap[state].forEach(city => {
                    const option = document.createElement('option');
                    option.value = city;
                    option.text = city;
                    cityDropdown.add(option);
                });
            }
        }

        // Handle form submission
        document.getElementById('rfp-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            fetch('https://script.google.com/macros/s/AKfycby6d5uneehm3a29RqscR3P-Nc6t1fF9pvSRfHHXYz-cuL3gMJ1ZdoiyfQ8pudcIDArc/exec', {
                method: 'POST',
                body: formData
            })
            .then(response => {
                if (response.ok) {
                    window.location.href = 'confirmation.html'; // Redirect to confirmation page
                } else {
                    return response.text();
                }
            })
            .then(data => {
                if (data) {
                    alert('Error: ' + data);
                }
            })
            .catch(error => console.error('Error:', error));
        });
    });
</script>

</body>
</html>
